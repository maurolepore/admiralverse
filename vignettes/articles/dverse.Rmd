# Spell-checked R Markdown Code

---
title: "Creating a Global Search"
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r admiralverse}
#| eval: false
#| echo: false
# Admiral packages on CRAN with a website
admiralverse <- pak::pkg_search("admiral") |>
  dplyr::filter(grepl("admiral", package)) |>
  dplyr::filter(!is.na(url)) |>
  dplyr::pull(package)
admiralverse
```

This article shows how to create a global search for a collection of
packages. 

As an example, consider the toy admiralverse. You need the dverse package, all
the packages in the admiralverse, and some other packages to manipulate the
output of dverse and to create clickable and searchable tables.

```{r setup}
#| message: false
library(dverse)

libary(admiral)
libary(admiraldev)
libary(admiralonco)
libary(admiralophtha)
libary(admiralpeds)
libary(admiralvaccine)

library(dplyr)
library(DT)
```

Use `document_universe()` with the names of the packages in the admiralverse,
and the template pointing to each topic in each package.

```{r docs}
admiralverse <- c(
  "admiral",
  "admiraldev",
  "admiralonco",
  "admiralophtha",
  "admiralpeds",
  "admiralvaccine"
)

# Example: https://pharmaverse.github.io/admiral/reference/queries.html
template <- "https://pharmaverse.github.io/{package}/reference/{topic}.html"
docs <- dverse::document_universe(admiralverse, template)
docs
```

You may create a global search with `datatable(docs, escape = FALSE)`, but note
that the `docs` have multiple types of documentation.

```{r}
docs |> count(type, keyword)
```

For more control, consider creating a separate search engine for vignettes,
datasets, and (public) functions.

### Vignettes

```{r vignettes}
vignettes <- docs |> filter(type == "vignette")
vignettes |>
  select(topic, title, package) |>
  arrange(title, package) |>
  datatable(escape = FALSE)
```

### Datasets

You may also want to search for datasets.

```{r datasets}
datasets <- docs |> filter(keyword == "datasets")
datasets |>
  distinct(topic, title, package) |>
  datatable(escape = FALSE)
```

### Functions

```{r internals}
#| cache: true
internal <- docs |> filter(keyword == "internal")
public <- docs |>
  anti_join(vignettes) |>
  anti_join(datasets) |>
  anti_join(internal)

public |>
  distinct(topic, title, package) |>
  filter(dverse::is_online(topic)) |>
  datatable(escape = FALSE)
```

### Learn More

* [dverse](https://maurolepore.github.io/dverse/index.html).
* Creating the (toy) 'admiralverse' meta-package ([5' video](https://youtu.be/ezVpsadSF7A)).
* Creating a website for the (toy) 'admiralverse' with a global search ([9' video](https://youtu.be/VhmnADBDXv0)).
