---
title: "Document your universe with dverse"
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r admiralverse}
#| eval: false
#| echo: false
# admiral packages on CRAN with a website
admiralverse <- pak::pkg_search("admiral") |>
  dplyr::filter(grepl("admiral", package)) |>
  dplyr::filter(!is.na(url)) |>
  dplyr::pull(package)
admiralverse
```

This article shows how to create a global search for a collection of
packages. 

As an example consider the toy 'admiralverse'. You need to use the dverse
package, all the packages in the admiralverse, and likely some other packages to
manipulate the resulting documentation, and to generate click-able links to the
help files.

```{r setup}
#| message: false
# To generate documentation for the (toy) 'admiralverse'
library(dverse)
library(admiralverse)
# To manipulate and present the documentation
library(dplyr)
library(DT)
```

Use `document_universe()` with the names of the packages in the admiralverse,
and the template pointing to each topic in each package.

```{r docs}
admiralverse <- c(
  "admiral",
  "admiraldev",
  "admiralonco",
  "admiralophtha",
  "admiralpeds",
  "admiralvaccine"
)

# Example: https://pharmaverse.github.io/admiral/reference/queries.html
template <- "https://pharmaverse.github.io/{package}/reference/{topic}.html"
docs <- dverse::document_universe(admiralverse, template)
docs
```

You may create a global search with `datatable(docs, escape = FALSE)`, but note
the `docs` have multiple types of documentation.

```{r}
docs |> count(type, keyword)
```

For more control, consider creating a separate search engine for vignettes,
datasets, and (public) functions.

### Vignettes

```{r vignettes}
vignettes <- docs |> filter(type == "vignette")
vignettes |>
  select(topic, title, package) |>
  arrange(title, package) |>
  datatable(escape = FALSE)
```

### Datasets

They may also want to search for datasets.

```{r datasets}
datasets <- docs |> filter(keyword == "datasets")
datasets |>
  distinct(topic, title, package) |>
  datatable(escape = FALSE)
```

### Functions

```{r internals}
#| cache: true
internal <- docs |> filter(keyword == "internal")
public <- docs |>
  anti_join(vignettes) |>
  anti_join(datasets) |>
  anti_join(internal)

public |>
  distinct(topic, title, package) |>
  filter(dverse::is_online(topic)) |>
  datatable(escape = FALSE)
```

### Learn more

* [dverse](https://maurolepore.github.io/dverse/index.html).
* Creating the (toy) 'admiralverse'  meta-package ([5' video](https://youtu.be/ezVpsadSF7A)).
* Creating a website for the (toy) 'admiralverse' with a global search ([7' video](https://youtu.be/p7_1D7d9_GI)).
